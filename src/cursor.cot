/// Cursor position tracking for an editor surface.
/// Maps to Ghostty's cursor tracking within Surface.zig.

/// Logical cursor position: line, column, and byte offset into buffer.
struct Cursor {
    line: int,
    col: int,
    offset: int,
}

impl Cursor {
    /// Create a cursor at the start of the buffer.
    static fn init() Cursor {
        return Cursor { line: 0, col: 0, offset: 0 }
    }

    /// Move cursor one position to the right.
    fn moveRight(buf_len: int) void {
        if (self.offset < buf_len) {
            self.offset += 1
            self.col += 1
        }
    }

    /// Move cursor one position to the left.
    fn moveLeft() void {
        if (self.offset > 0) {
            self.offset -= 1
            if (self.col > 0) {
                self.col -= 1
            }
        }
    }

    /// Move cursor up one line. Requires line start offsets from the buffer.
    fn moveUp() void {
        if (self.line > 0) {
            self.line -= 1
        }
    }

    /// Move cursor down one line. Requires total line count from the buffer.
    fn moveDown(total_lines: int) void {
        if (self.line < total_lines - 1) {
            self.line += 1
        }
    }

    /// Move cursor to the start of the current line.
    fn moveToLineStart() void {
        self.col = 0
    }

    /// Move cursor to a specific position.
    fn moveTo(line: int, col: int, offset: int) void {
        self.line = line
        self.col = col
        self.offset = offset
    }
}

// ============================================================================
// Tests
// ============================================================================

test "cursor init" {
    var c = Cursor.init()
    @assertEq(c.line, 0)
    @assertEq(c.col, 0)
    @assertEq(c.offset, 0)
}

test "cursor move right" {
    var c = Cursor.init()
    c.moveRight(10)
    @assertEq(c.offset, 1)
    @assertEq(c.col, 1)
    c.moveRight(10)
    @assertEq(c.offset, 2)
    @assertEq(c.col, 2)
}

test "cursor move right at end" {
    var c = Cursor.init()
    c.moveRight(0)
    @assertEq(c.offset, 0)
    @assertEq(c.col, 0)
}

test "cursor move left" {
    var c = Cursor.init()
    c.moveRight(10)
    c.moveRight(10)
    c.moveLeft()
    @assertEq(c.offset, 1)
    @assertEq(c.col, 1)
}

test "cursor move left at start" {
    var c = Cursor.init()
    c.moveLeft()
    @assertEq(c.offset, 0)
    @assertEq(c.col, 0)
}

test "cursor move up" {
    var c = Cursor.init()
    c.line = 3
    c.moveUp()
    @assertEq(c.line, 2)
    c.moveUp()
    @assertEq(c.line, 1)
}

test "cursor move up at top" {
    var c = Cursor.init()
    c.moveUp()
    @assertEq(c.line, 0)
}

test "cursor move down" {
    var c = Cursor.init()
    c.moveDown(5)
    @assertEq(c.line, 1)
    c.moveDown(5)
    @assertEq(c.line, 2)
}

test "cursor move down at bottom" {
    var c = Cursor.init()
    c.line = 4
    c.moveDown(5)
    @assertEq(c.line, 4)
}

test "cursor move to line start" {
    var c = Cursor.init()
    c.col = 15
    c.moveToLineStart()
    @assertEq(c.col, 0)
}

test "cursor move to" {
    var c = Cursor.init()
    c.moveTo(5, 10, 42)
    @assertEq(c.line, 5)
    @assertEq(c.col, 10)
    @assertEq(c.offset, 42)
}
